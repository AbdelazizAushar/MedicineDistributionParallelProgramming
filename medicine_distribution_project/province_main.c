#include <stdio.h>
#include <stdlib.h>
#include <pvm3.h>

#include "province.h"
#include "pvm_helpers.h"
#include "message.h"

int main(int argc, char* argv[]) {
    // ???? ?? ??? ???????
    if (argc < 4) {
        fprintf(stderr, "[Province] Invalid number of arguments. Expected 3.\n");
        return 1;
    }

    // ????? ??????? ??????? ?? ???? (???????)
    int province_id = atoi(argv[1]);         // ??? ????????
    int num_distributors = atoi(argv[2]);    // ??? ????????
    int total_requests = atoi(argv[3]);      // ??? ??????? ?????

    // ?????? ??? TID ????? ?? ?TID ????? ????????
    int my_tid = pvm_mytid();
    int master_tid = pvm_parent();

    // ????? TID ????? ?? ??? ??????? ????? ???? ???? ???????
    send_int(master_tid, MSG_REGISTER_PROVINCE, my_tid);

    // ????? ????????
    if (province_init(province_id, num_distributors, total_requests) != 0) {
        return 1;
    }

    // ??? ???? ?????
    province_run();

    // ????? ?????? ???????
    province_finalize();

    return 0;
}
